import{h as B,r as a,j as e,k as I,B as q,P as G,T as L}from"./index-62307a83.js";import{u as $,D as P,a as _,b as z,C as g,c as V,d as H,e as C,o as J,f as K,G as W,g as Q,h as U,L as X,i as Y,I as Z,j as ee,k as oe,l as re,S as ie}from"./index.esm-880747b5.js";import"./agentService-cbb174ed.js";import{i as y}from"./inmobiliariaService-eb7ce1fa.js";import{G as d}from"./Grid-fa45856e.js";import{T as u}from"./TextField-1b0da952.js";const te=o=>H({nombre:C().required(o("inmobiliarias.validation.nombreRequired")),rfc:C().required(o("inmobiliarias.validation.rfcRequired")),nombreContacto:C().required(o("inmobiliarias.validation.nombreRequired")),correo:C().email(o("inmobiliarias.validation.correoInvalid")).required(o("inmobiliarias.validation.correoRequired")),telefono:C().required(o("inmobiliarias.validation.telefonoRequired"))}),ae=({open:o,inmobiliaria:s,onClose:S,onSuccess:w})=>{const{t:n}=B(),f=!!s,D=a.useMemo(()=>te(n),[n]),{control:c,handleSubmit:m,reset:b,formState:{errors:l,isSubmitting:v}}=$({resolver:J(D),defaultValues:{nombre:"",rfc:"",nombreContacto:"",correo:"",telefono:""}});a.useEffect(()=>{b(s?{nombre:s.nombre,rfc:s.rfc,nombreContacto:s.nombreContacto,correo:s.correo,telefono:s.telefono}:{nombre:"",rfc:"",nombreContacto:"",correo:"",telefono:""})},[s,b]);const h=async i=>{const r={nombre:i.nombre.trim(),rfc:i.rfc.trim(),nombreContacto:i.nombreContacto.trim(),correo:i.correo.trim(),telefono:i.telefono.trim()};try{f&&s?await y.update(s.id,{...r,id:s.id}):await y.create(r),w()}catch(x){console.error("Error saving inmobiliaria",x)}};return e.jsx(P,{open:o,onClose:S,maxWidth:"md",fullWidth:!0,children:e.jsxs("form",{onSubmit:m(h),children:[e.jsx(_,{children:n(f?"inmobiliarias.edit":"inmobiliarias.create")}),e.jsx(z,{children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(g,{name:"nombre",control:c,render:({field:i})=>{var r;return e.jsx(u,{...i,fullWidth:!0,label:n("inmobiliarias.fields.nombre"),error:!!l.nombre,helperText:(r=l.nombre)==null?void 0:r.message})}})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(g,{name:"rfc",control:c,render:({field:i})=>{var r;return e.jsx(u,{...i,fullWidth:!0,label:n("inmobiliarias.fields.rfc"),error:!!l.rfc,helperText:(r=l.rfc)==null?void 0:r.message})}})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(g,{name:"nombreContacto",control:c,render:({field:i})=>{var r;return e.jsx(u,{...i,fullWidth:!0,label:n("inmobiliarias.fields.nombreContacto"),error:!!l.nombreContacto,helperText:(r=l.nombreContacto)==null?void 0:r.message})}})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(g,{name:"correo",control:c,render:({field:i})=>{var r;return e.jsx(u,{...i,fullWidth:!0,type:"email",label:n("inmobiliarias.fields.correo"),error:!!l.correo,helperText:(r=l.correo)==null?void 0:r.message})}})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(g,{name:"telefono",control:c,render:({field:i})=>{var r;return e.jsx(u,{...i,fullWidth:!0,label:n("inmobiliarias.fields.telefono"),error:!!l.telefono,helperText:(r=l.telefono)==null?void 0:r.message})}})})]})}),e.jsxs(V,{children:[e.jsx(I,{onClick:S,disabled:v,children:n("common.cancel")}),e.jsx(I,{type:"submit",variant:"contained",disabled:v,children:n("common.save")})]})]})})},ue=()=>{const{t:o}=B(),[s,S]=a.useState([]),[w,n]=a.useState(!0),[f,D]=a.useState(""),[c,m]=a.useState(!1),[b,l]=a.useState(null),[v,h]=a.useState(!1),[i,r]=a.useState(null),[x,p]=a.useState({open:!1,message:"",severity:"success"}),k=K(f,300),j=a.useCallback(async()=>{try{n(!0);const t=await y.getAll();S(t)}catch(t){console.error("Error loading inmobiliarias",t),p({open:!0,message:o("common.saveError"),severity:"error"})}finally{n(!1)}},[o]);a.useEffect(()=>{j()},[j]);const N=a.useCallback(()=>{l(null),m(!0)},[]),T=a.useCallback(t=>{l(t),m(!0)},[]),E=a.useCallback(t=>{r(t),h(!0)},[]),O=async()=>{if(i!==null)try{await y.delete(i),p({open:!0,message:o("common.deleteSuccess"),severity:"success"}),await j()}catch(t){console.error("Error deleting inmobiliaria",t),p({open:!0,message:o("common.deleteError"),severity:"error"})}finally{h(!1),r(null)}},R=a.useCallback(async()=>{m(!1),await j(),p({open:!0,message:o("common.saveSuccess"),severity:"success"})},[j,o]),A=a.useMemo(()=>[{field:"id",headerName:"ID",width:80},{field:"nombre",headerName:o("inmobiliarias.fields.nombre"),flex:1,minWidth:200},{field:"rfc",headerName:o("inmobiliarias.fields.rfc"),width:160},{field:"nombreContacto",headerName:o("inmobiliarias.fields.nombreContacto"),width:220},{field:"correo",headerName:o("inmobiliarias.fields.correo"),width:220},{field:"telefono",headerName:o("inmobiliarias.fields.telefono"),width:160},{field:"actions",type:"actions",headerName:o("common.actions"),width:120,getActions:t=>[e.jsx(W,{icon:e.jsx(Q,{}),label:o("common.edit"),onClick:()=>T(t.row),showInMenu:!1},"edit"),e.jsx(W,{icon:e.jsx(U,{}),label:o("common.delete"),onClick:()=>E(t.row.id),showInMenu:!1},"delete")]}],[E,T,o]),M=a.useMemo(()=>s.filter(t=>Object.values(t).some(F=>String(F??"").toLowerCase().includes(k.trim().toLowerCase()))),[s,k]);return w?e.jsx(X,{fullScreen:!0}):e.jsxs(q,{sx:{p:3},children:[e.jsxs(G,{sx:{p:3},children:[e.jsxs(q,{sx:{display:"flex",justifyContent:"space-between",mb:3,flexWrap:"wrap",gap:2},children:[e.jsx(L,{variant:"h4",children:o("inmobiliarias.title")}),e.jsx(I,{variant:"contained",startIcon:e.jsx(Y,{}),onClick:N,children:o("inmobiliarias.create")})]}),e.jsx(u,{fullWidth:!0,placeholder:o("common.search"),value:f,onChange:t=>D(t.target.value),sx:{mb:2},InputProps:{startAdornment:e.jsx(Z,{position:"start",children:e.jsx(ee,{})})}}),e.jsx(oe,{rows:M,columns:A,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[5,10,25,50],disableRowSelectionOnClick:!0,autoHeight:!0})]}),e.jsx(ae,{open:c,inmobiliaria:b,onClose:()=>m(!1),onSuccess:R}),e.jsx(re,{open:v,title:o("common.delete"),onConfirm:O,onCancel:()=>h(!1)}),e.jsx(ie,{open:x.open,message:x.message,severity:x.severity,onClose:()=>p(t=>({...t,open:!1}))})]})};export{ae as InmobiliariaFormDialog,ue as InmobiliariasPage};
