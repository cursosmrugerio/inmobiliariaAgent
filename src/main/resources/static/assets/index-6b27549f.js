import{v as I,h as P,r as s,j as i,w,k as F,B as R,P as U,T as X,F as Y,I as Z,S as V}from"./index-62307a83.js";import{u as ee,o as ie,D as ae,a as se,b as re,C as y,c as oe,d as te,e as D,m as ne,f as le,T as de,G as q,g as ce,h as me,L as ue,i as pe,I as be,j as he,k as xe,l as fe,S as ve}from"./index.esm-880747b5.js";import"./agentService-cbb174ed.js";import{i as je}from"./inmobiliariaService-eb7ce1fa.js";import{G as x}from"./Grid-fa45856e.js";import{T as f}from"./TextField-1b0da952.js";const O={getAll:async e=>{const r=e?{inmobiliariaId:e}:{};return(await I.get("/propiedades",{params:r})).data},getById:async e=>(await I.get(`/propiedades/${e}`)).data,create:async e=>(await I.post("/propiedades",e)).data,update:async(e,r)=>(await I.put(`/propiedades/${e}`,r)).data,delete:async e=>{await I.delete(`/propiedades/${e}`)}};var A=(e=>(e.CASA="CASA",e.DEPARTAMENTO="DEPARTAMENTO",e.LOCAL_COMERCIAL="LOCAL_COMERCIAL",e.OFICINA="OFICINA",e.BODEGA="BODEGA",e.TERRENO="TERRENO",e))(A||{});const ge=e=>te({nombre:D().required(e("propiedades.validation.nombreRequired")),tipo:ne().oneOf(Object.values(A),e("propiedades.validation.tipoRequired")).required(e("propiedades.validation.tipoRequired")),direccion:D().required(e("propiedades.validation.direccionRequired")),inmobiliariaId:D().required(e("propiedades.validation.inmobiliariaRequired")),observaciones:D().transform(r=>r??"").optional()}),Ce=({open:e,propiedad:r,inmobiliarias:v,onClose:j,onSuccess:k})=>{const{t:n}=P(),g=!!r,E=s.useMemo(()=>ge(n),[n]),{control:u,handleSubmit:c,reset:C,formState:{errors:m,isSubmitting:p}}=ee({resolver:ie(E),defaultValues:{nombre:"",tipo:A.CASA,direccion:"",observaciones:"",inmobiliariaId:""}});s.useEffect(()=>{C(r?{nombre:r.nombre,tipo:r.tipo,direccion:r.direccion,observaciones:r.observaciones,inmobiliariaId:String(r.inmobiliariaId)}:{nombre:"",tipo:A.CASA,direccion:"",observaciones:"",inmobiliariaId:""})},[r,C]);const T=async o=>{var l;const t={nombre:o.nombre.trim(),tipo:o.tipo,direccion:o.direccion.trim(),observaciones:((l=o.observaciones)==null?void 0:l.trim())??"",inmobiliariaId:Number(o.inmobiliariaId)};try{g&&r?await O.update(r.id,{...t,id:r.id}):await O.create(t),k()}catch(S){console.error("Error saving propiedad",S)}};return i.jsx(ae,{open:e,onClose:j,maxWidth:"md",fullWidth:!0,children:i.jsxs("form",{onSubmit:c(T),children:[i.jsx(se,{children:n(g?"propiedades.edit":"propiedades.create")}),i.jsx(re,{children:i.jsxs(x,{container:!0,spacing:2,sx:{mt:1},children:[i.jsx(x,{item:!0,xs:12,md:6,children:i.jsx(y,{name:"nombre",control:u,render:({field:o})=>{var t;return i.jsx(f,{...o,fullWidth:!0,label:n("propiedades.fields.nombre"),error:!!m.nombre,helperText:(t=m.nombre)==null?void 0:t.message})}})}),i.jsx(x,{item:!0,xs:12,md:6,children:i.jsx(y,{name:"tipo",control:u,render:({field:o})=>{var t;return i.jsx(f,{...o,select:!0,fullWidth:!0,label:n("propiedades.fields.tipo"),error:!!m.tipo,helperText:(t=m.tipo)==null?void 0:t.message,children:Object.values(A).map(l=>i.jsx(w,{value:l,children:n(`propiedades.tipos.${l}`)},l))})}})}),i.jsx(x,{item:!0,xs:12,children:i.jsx(y,{name:"direccion",control:u,render:({field:o})=>{var t;return i.jsx(f,{...o,fullWidth:!0,label:n("propiedades.fields.direccion"),error:!!m.direccion,helperText:(t=m.direccion)==null?void 0:t.message})}})}),i.jsx(x,{item:!0,xs:12,children:i.jsx(y,{name:"observaciones",control:u,render:({field:o})=>{var t;return i.jsx(f,{...o,fullWidth:!0,multiline:!0,minRows:3,label:n("propiedades.fields.observaciones"),error:!!m.observaciones,helperText:(t=m.observaciones)==null?void 0:t.message})}})}),i.jsx(x,{item:!0,xs:12,md:6,children:i.jsx(y,{name:"inmobiliariaId",control:u,render:({field:o})=>{var t;return i.jsxs(f,{...o,select:!0,fullWidth:!0,label:n("propiedades.fields.inmobiliaria"),value:o.value,onChange:o.onChange,error:!!m.inmobiliariaId,helperText:(t=m.inmobiliariaId)==null?void 0:t.message,children:[i.jsx(w,{value:"",children:n("propiedades.fields.inmobiliaria")}),v.map(l=>i.jsx(w,{value:l.id,children:l.nombre},l.id))]})}})})]})}),i.jsxs(oe,{children:[i.jsx(F,{onClick:j,disabled:p,children:n("common.cancel")}),i.jsx(F,{type:"submit",variant:"contained",disabled:p,children:n("common.save")})]})]})})},De=()=>{const{t:e}=P(),[r,v]=s.useState([]),[j,k]=s.useState([]),[n,g]=s.useState(!0),[E,u]=s.useState(""),[c,C]=s.useState("all"),[m,p]=s.useState(!1),[T,o]=s.useState(null),[t,l]=s.useState(!1),[S,W]=s.useState(null),[N,b]=s.useState({open:!1,message:"",severity:"success"}),B=le(E,300),L=s.useCallback(async()=>{try{const a=await je.getAll();k(a)}catch(a){console.error("Error loading inmobiliarias",a),b({open:!0,message:e("common.saveError"),severity:"error"})}},[e]),h=s.useCallback(async a=>{try{g(!0);const d=await O.getAll(a);v(d)}catch(d){console.error("Error loading propiedades",d),b({open:!0,message:e("common.saveError"),severity:"error"})}finally{g(!1)}},[e]);s.useEffect(()=>{L()},[L]),s.useEffect(()=>{h(c==="all"?void 0:c)},[h,c]);const G=s.useCallback(()=>{o(null),p(!0)},[]),$=s.useCallback(a=>{o(a),p(!0)},[]),M=s.useCallback(a=>{W(a),l(!0)},[]),_=s.useCallback(async()=>{if(S!==null)try{await O.delete(S),b({open:!0,message:e("common.deleteSuccess"),severity:"success"}),await h(c==="all"?void 0:c)}catch(a){console.error("Error deleting propiedad",a),b({open:!0,message:e("common.deleteError"),severity:"error"})}finally{l(!1),W(null)}},[S,h,c,e]),z=s.useCallback(async()=>{p(!1),await h(c==="all"?void 0:c),b({open:!0,message:e("common.saveSuccess"),severity:"success"})},[h,c,e]),H=s.useCallback(a=>{const d=a.target.value;C(d==="all"?"all":Number(d))},[]),J=s.useMemo(()=>[{field:"id",headerName:"ID",width:80},{field:"nombre",headerName:e("propiedades.fields.nombre"),flex:1,minWidth:200},{field:"tipo",headerName:e("propiedades.fields.tipo"),width:160,valueFormatter:({value:a})=>e(`propiedades.tipos.${a}`)},{field:"direccion",headerName:e("propiedades.fields.direccion"),flex:1,minWidth:240},{field:"observaciones",headerName:e("propiedades.fields.observaciones"),flex:1,minWidth:240,renderCell:a=>{const d=a.value??"",Q=d.length>40?`${d.slice(0,37)}â€¦`:d;return i.jsx(de,{title:d,children:i.jsx("span",{children:d?Q:"-"})})}},{field:"inmobiliariaNombre",headerName:e("propiedades.fields.inmobiliaria"),width:220},{field:"actions",type:"actions",headerName:e("common.actions"),width:120,getActions:a=>[i.jsx(q,{icon:i.jsx(ce,{}),label:e("common.edit"),onClick:()=>$(a.row),showInMenu:!1},"edit"),i.jsx(q,{icon:i.jsx(me,{}),label:e("common.delete"),onClick:()=>M(a.row.id),showInMenu:!1},"delete")]}],[M,$,e]),K=s.useMemo(()=>r.filter(a=>Object.values(a).some(d=>String(d??"").toLowerCase().includes(B.trim().toLowerCase()))),[r,B]);return n?i.jsx(ue,{fullScreen:!0}):i.jsxs(R,{sx:{p:3},children:[i.jsxs(U,{sx:{p:3},children:[i.jsxs(R,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",gap:2,mb:3},children:[i.jsx(X,{variant:"h4",children:e("propiedades.title")}),i.jsx(F,{variant:"contained",startIcon:i.jsx(pe,{}),onClick:G,children:e("propiedades.create")})]}),i.jsxs(R,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,mb:2},children:[i.jsx(f,{fullWidth:!0,placeholder:e("common.search"),value:E,onChange:a=>u(a.target.value),InputProps:{startAdornment:i.jsx(be,{position:"start",children:i.jsx(he,{})})}}),i.jsxs(Y,{sx:{minWidth:{xs:"100%",md:240}},size:"small",children:[i.jsx(Z,{id:"propiedades-inmobiliaria-filter-label",children:e("propiedades.fields.inmobiliaria")}),i.jsxs(V,{labelId:"propiedades-inmobiliaria-filter-label",value:c==="all"?"all":String(c),label:e("propiedades.fields.inmobiliaria"),onChange:H,children:[i.jsx(w,{value:"all",children:e("common.all")}),j.map(a=>i.jsx(w,{value:a.id,children:a.nombre},a.id))]})]})]}),i.jsx(xe,{rows:K,columns:J,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[5,10,25,50],disableRowSelectionOnClick:!0,autoHeight:!0})]}),i.jsx(Ce,{open:m,propiedad:T,onClose:()=>p(!1),onSuccess:z,inmobiliarias:j}),i.jsx(fe,{open:t,title:e("common.delete"),onConfirm:_,onCancel:()=>l(!1)}),i.jsx(ve,{open:N.open,message:N.message,severity:N.severity,onClose:()=>b(a=>({...a,open:!1}))})]})};export{Ce as PropiedadFormDialog,De as PropiedadesPage};
