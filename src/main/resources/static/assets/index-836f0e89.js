import{h as $,r as s,j as e,v as I,k as R,B as N,P as Q,T as U,F as X,I as Y,S as Z}from"./index-83d1839a.js";import{u as V,o as ee,D as ie,a as ae,b as se,C as S,c as re,d as oe,e as E,m as te,f as ne,T as le,G as q,g as de,h as ce,i as me,I as ue,j as pe,k as be,l as he,S as xe}from"./index.esm-9cf95b61.js";import{G as x,L as fe}from"./LoadingSpinner-fa054fe4.js";import"./agentService-0a27ba7e.js";import{i as ve}from"./inmobiliariaService-8a308489.js";import{p as w}from"./propiedadService-59ed13e6.js";import{T as f}from"./TextField-66d2e082.js";import"./ToggleButton-e374f116.js";var y=(i=>(i.CASA="CASA",i.DEPARTAMENTO="DEPARTAMENTO",i.LOCAL_COMERCIAL="LOCAL_COMERCIAL",i.OFICINA="OFICINA",i.BODEGA="BODEGA",i.TERRENO="TERRENO",i))(y||{});const je=i=>oe({nombre:E().required(i("propiedades.validation.nombreRequired")),tipo:te().oneOf(Object.values(y),i("propiedades.validation.tipoRequired")).required(i("propiedades.validation.tipoRequired")),direccion:E().required(i("propiedades.validation.direccionRequired")),inmobiliariaId:E().required(i("propiedades.validation.inmobiliariaRequired")),observaciones:E().transform(t=>t??"").optional()}),ge=({open:i,propiedad:t,inmobiliarias:D,onClose:v,onSuccess:O})=>{const{t:n}=$(),j=!!t,A=s.useMemo(()=>je(n),[n]),{control:u,handleSubmit:c,reset:g,formState:{errors:m,isSubmitting:p}}=V({resolver:ee(A),defaultValues:{nombre:"",tipo:y.CASA,direccion:"",observaciones:"",inmobiliariaId:""}});s.useEffect(()=>{g(t?{nombre:t.nombre,tipo:t.tipo,direccion:t.direccion,observaciones:t.observaciones,inmobiliariaId:String(t.inmobiliariaId)}:{nombre:"",tipo:y.CASA,direccion:"",observaciones:"",inmobiliariaId:""})},[t,g]);const k=async r=>{var l;const o={nombre:r.nombre.trim(),tipo:r.tipo,direccion:r.direccion.trim(),observaciones:((l=r.observaciones)==null?void 0:l.trim())??"",inmobiliariaId:Number(r.inmobiliariaId)};try{j&&t?await w.update(t.id,{...o,id:t.id}):await w.create(o),O()}catch(C){console.error("Error saving propiedad",C)}};return e.jsx(ie,{open:i,onClose:v,maxWidth:"md",fullWidth:!0,children:e.jsxs("form",{onSubmit:c(k),children:[e.jsx(ae,{children:n(j?"propiedades.edit":"propiedades.create")}),e.jsx(se,{children:e.jsxs(x,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(x,{item:!0,xs:12,md:6,children:e.jsx(S,{name:"nombre",control:u,render:({field:r})=>{var o;return e.jsx(f,{...r,fullWidth:!0,label:n("propiedades.fields.nombre"),error:!!m.nombre,helperText:(o=m.nombre)==null?void 0:o.message})}})}),e.jsx(x,{item:!0,xs:12,md:6,children:e.jsx(S,{name:"tipo",control:u,render:({field:r})=>{var o;return e.jsx(f,{...r,select:!0,fullWidth:!0,label:n("propiedades.fields.tipo"),error:!!m.tipo,helperText:(o=m.tipo)==null?void 0:o.message,children:Object.values(y).map(l=>e.jsx(I,{value:l,children:n(`propiedades.tipos.${l}`)},l))})}})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(S,{name:"direccion",control:u,render:({field:r})=>{var o;return e.jsx(f,{...r,fullWidth:!0,label:n("propiedades.fields.direccion"),error:!!m.direccion,helperText:(o=m.direccion)==null?void 0:o.message})}})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(S,{name:"observaciones",control:u,render:({field:r})=>{var o;return e.jsx(f,{...r,fullWidth:!0,multiline:!0,minRows:3,label:n("propiedades.fields.observaciones"),error:!!m.observaciones,helperText:(o=m.observaciones)==null?void 0:o.message})}})}),e.jsx(x,{item:!0,xs:12,md:6,children:e.jsx(S,{name:"inmobiliariaId",control:u,render:({field:r})=>{var o;return e.jsxs(f,{...r,select:!0,fullWidth:!0,label:n("propiedades.fields.inmobiliaria"),value:r.value,onChange:r.onChange,error:!!m.inmobiliariaId,helperText:(o=m.inmobiliariaId)==null?void 0:o.message,children:[e.jsx(I,{value:"",children:n("propiedades.fields.inmobiliaria")}),D.map(l=>e.jsx(I,{value:l.id,children:l.nombre},l.id))]})}})})]})}),e.jsxs(re,{children:[e.jsx(R,{onClick:v,disabled:p,children:n("common.cancel")}),e.jsx(R,{type:"submit",variant:"contained",disabled:p,children:n("common.save")})]})]})})},Oe=()=>{const{t:i}=$(),[t,D]=s.useState([]),[v,O]=s.useState([]),[n,j]=s.useState(!0),[A,u]=s.useState(""),[c,g]=s.useState("all"),[m,p]=s.useState(!1),[k,r]=s.useState(null),[o,l]=s.useState(!1),[C,F]=s.useState(null),[T,b]=s.useState({open:!1,message:"",severity:"success"}),W=ne(A,300),L=s.useCallback(async()=>{try{const a=await ve.getAll();O(a)}catch(a){console.error("Error loading inmobiliarias",a),b({open:!0,message:i("common.saveError"),severity:"error"})}},[i]),h=s.useCallback(async a=>{try{j(!0);const d=await w.getAll(a);D(d)}catch(d){console.error("Error loading propiedades",d),b({open:!0,message:i("common.saveError"),severity:"error"})}finally{j(!1)}},[i]);s.useEffect(()=>{L()},[L]),s.useEffect(()=>{h(c==="all"?void 0:c)},[h,c]);const P=s.useCallback(()=>{r(null),p(!0)},[]),B=s.useCallback(a=>{r(a),p(!0)},[]),M=s.useCallback(a=>{F(a),l(!0)},[]),G=s.useCallback(async()=>{if(C!==null)try{await w.delete(C),b({open:!0,message:i("common.deleteSuccess"),severity:"success"}),await h(c==="all"?void 0:c)}catch(a){console.error("Error deleting propiedad",a),b({open:!0,message:i("common.deleteError"),severity:"error"})}finally{l(!1),F(null)}},[C,h,c,i]),_=s.useCallback(async()=>{p(!1),await h(c==="all"?void 0:c),b({open:!0,message:i("common.saveSuccess"),severity:"success"})},[h,c,i]),z=s.useCallback(a=>{const d=a.target.value;g(d==="all"?"all":Number(d))},[]),H=s.useMemo(()=>[{field:"id",headerName:"ID",width:80},{field:"nombre",headerName:i("propiedades.fields.nombre"),flex:1,minWidth:200},{field:"tipo",headerName:i("propiedades.fields.tipo"),width:160,valueFormatter:({value:a})=>i(`propiedades.tipos.${a}`)},{field:"direccion",headerName:i("propiedades.fields.direccion"),flex:1,minWidth:240},{field:"observaciones",headerName:i("propiedades.fields.observaciones"),flex:1,minWidth:240,renderCell:a=>{const d=a.value??"",K=d.length>40?`${d.slice(0,37)}â€¦`:d;return e.jsx(le,{title:d,children:e.jsx("span",{children:d?K:"-"})})}},{field:"inmobiliariaNombre",headerName:i("propiedades.fields.inmobiliaria"),width:220},{field:"actions",type:"actions",headerName:i("common.actions"),width:120,getActions:a=>[e.jsx(q,{icon:e.jsx(de,{}),label:i("common.edit"),onClick:()=>B(a.row),showInMenu:!1},"edit"),e.jsx(q,{icon:e.jsx(ce,{}),label:i("common.delete"),onClick:()=>M(a.row.id),showInMenu:!1},"delete")]}],[M,B,i]),J=s.useMemo(()=>t.filter(a=>Object.values(a).some(d=>String(d??"").toLowerCase().includes(W.trim().toLowerCase()))),[t,W]);return n?e.jsx(fe,{fullScreen:!0}):e.jsxs(N,{sx:{p:3},children:[e.jsxs(Q,{sx:{p:3},children:[e.jsxs(N,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",gap:2,mb:3},children:[e.jsx(U,{variant:"h4",children:i("propiedades.title")}),e.jsx(R,{variant:"contained",startIcon:e.jsx(me,{}),onClick:P,children:i("propiedades.create")})]}),e.jsxs(N,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,mb:2},children:[e.jsx(f,{fullWidth:!0,placeholder:i("common.search"),value:A,onChange:a=>u(a.target.value),InputProps:{startAdornment:e.jsx(ue,{position:"start",children:e.jsx(pe,{})})}}),e.jsxs(X,{sx:{minWidth:{xs:"100%",md:240}},size:"small",children:[e.jsx(Y,{id:"propiedades-inmobiliaria-filter-label",children:i("propiedades.fields.inmobiliaria")}),e.jsxs(Z,{labelId:"propiedades-inmobiliaria-filter-label",value:c==="all"?"all":String(c),label:i("propiedades.fields.inmobiliaria"),onChange:z,children:[e.jsx(I,{value:"all",children:i("common.all")}),v.map(a=>e.jsx(I,{value:a.id,children:a.nombre},a.id))]})]})]}),e.jsx(be,{rows:J,columns:H,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[5,10,25,50],disableRowSelectionOnClick:!0,autoHeight:!0})]}),e.jsx(ge,{open:m,propiedad:k,onClose:()=>p(!1),onSuccess:_,inmobiliarias:v}),e.jsx(he,{open:o,title:i("common.delete"),onConfirm:G,onCancel:()=>l(!1)}),e.jsx(xe,{open:T.open,message:T.message,severity:T.severity,onClose:()=>b(a=>({...a,open:!1}))})]})};export{ge as PropiedadFormDialog,Oe as PropiedadesPage};
