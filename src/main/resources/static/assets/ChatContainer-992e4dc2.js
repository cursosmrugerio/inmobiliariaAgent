import{r as i,g as Q,a as X,s as Z,c as V,_ as L,u as ee,b as te,j as e,d as se,e as oe,f as G,i as E,h as k,B as g,T as j,k as ne,l as H,P,M as re,m as ae,n as ie,C as le}from"./index-83d1839a.js";import{A as D,a as de}from"./agentService-0a27ba7e.js";import{t as S,T as ce,a as ue,M as pe,C as ge}from"./ToggleButton-e374f116.js";import{A as K,T as me}from"./TextField-66d2e082.js";function xe(s){return i.Children.toArray(s).filter(t=>i.isValidElement(t))}function fe(s){return X("MuiToggleButtonGroup",s)}const he=Q("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),n=he,ve=["children","className","color","disabled","exclusive","fullWidth","onChange","orientation","size","value"],ye=s=>{const{classes:t,orientation:r,fullWidth:o,disabled:d}=s,l={root:["root",r==="vertical"&&"vertical",o&&"fullWidth"],grouped:["grouped",`grouped${V(r)}`,d&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return oe(l,fe,t)},be=Z("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:r}=s;return[{[`& .${n.grouped}`]:t.grouped},{[`& .${n.grouped}`]:t[`grouped${V(r.orientation)}`]},{[`& .${n.firstButton}`]:t.firstButton},{[`& .${n.lastButton}`]:t.lastButton},{[`& .${n.middleButton}`]:t.middleButton},t.root,r.orientation==="vertical"&&t.vertical,r.fullWidth&&t.fullWidth]}})(({ownerState:s,theme:t})=>L({display:"inline-flex",borderRadius:(t.vars||t).shape.borderRadius},s.orientation==="vertical"&&{flexDirection:"column"},s.fullWidth&&{width:"100%"},{[`& .${n.grouped}`]:L({},s.orientation==="horizontal"?{[`&.${n.selected} + .${n.grouped}.${n.selected}`]:{borderLeft:0,marginLeft:0}}:{[`&.${n.selected} + .${n.grouped}.${n.selected}`]:{borderTop:0,marginTop:0}})},s.orientation==="horizontal"?{[`& .${n.firstButton},& .${n.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${n.lastButton},& .${n.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0}}:{[`& .${n.firstButton},& .${n.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${n.lastButton},& .${n.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0}},s.orientation==="horizontal"?{[`& .${n.lastButton}.${S.disabled},& .${n.middleButton}.${S.disabled}`]:{borderLeft:"1px solid transparent"}}:{[`& .${n.lastButton}.${S.disabled},& .${n.middleButton}.${S.disabled}`]:{borderTop:"1px solid transparent"}})),Be=i.forwardRef(function(t,r){const o=ee({props:t,name:"MuiToggleButtonGroup"}),{children:d,className:l,color:m="standard",disabled:a=!1,exclusive:h=!1,fullWidth:f=!1,onChange:c,orientation:v="horizontal",size:C="medium",value:p}=o,$=te(o,ve),I=L({},o,{disabled:a,fullWidth:f,orientation:v,size:C}),y=ye(I),R=i.useCallback((B,x)=>{if(!c)return;const _=p&&p.indexOf(x);let A;p&&_>=0?(A=p.slice(),A.splice(_,1)):A=p?p.concat(x):[x],c(B,A)},[c,p]),M=i.useCallback((B,x)=>{c&&c(B,p===x?null:x)},[c,p]),b=i.useMemo(()=>({className:y.grouped,onChange:h?M:R,value:p,size:C,fullWidth:f,color:m,disabled:a}),[y.grouped,h,M,R,p,C,f,m,a]),u=xe(d),T=u.length,w=B=>{const x=B===0,_=B===T-1;return x&&_?"":x?y.firstButton:_?y.lastButton:y.middleButton};return e.jsx(be,L({role:"group",className:se(y.root,l),ref:r,ownerState:I},$,{children:e.jsx(ce.Provider,{value:b,children:u.map((B,x)=>e.jsx(ue.Provider,{value:w(x),children:B},x))})}))}),je=Be;var U={},Ce=E;Object.defineProperty(U,"__esModule",{value:!0});var Y=U.default=void 0,$e=Ce(G()),q=e;Y=U.default=(0,$e.default)([(0,q.jsx)("path",{d:"M1 11v10h5v-6h4v6h5V11L8 6z"},"0"),(0,q.jsx)("path",{d:"M10 3v1.97l7 5V11h2v2h-2v2h2v2h-2v4h6V3zm9 6h-2V7h2z"},"1")],"HomeWork");var N={},Ie=E;Object.defineProperty(N,"__esModule",{value:!0});var F=N.default=void 0,Re=Ie(G()),Me=e;F=N.default=(0,Re.default)((0,Me.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person");const Te={business:H,homework:Y,person:F},z=s=>{const t=s.toLowerCase();return Te[t]??H},we=({currentAgent:s,onChangeAgent:t,onClearConversation:r})=>{const{t:o}=k(),d=[{type:D.INMOBILIARIA,name:o("agents.inmobiliaria.name"),description:o("agents.inmobiliaria.description"),endpoint:"/agent/chat",icon:"Business",Icon:z("business")},{type:D.PROPIEDAD,name:o("agents.propiedad.name"),description:o("agents.propiedad.description"),endpoint:"/agent/propiedades/chat",icon:"HomeWork",Icon:z("homework")},{type:D.PERSONA,name:o("agents.persona.name"),description:o("agents.persona.description"),endpoint:"/agent/personas/chat",icon:"Person",Icon:z("person")}],l=(m,a)=>{a&&a!==s&&t(a)};return e.jsxs(g,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,alignItems:{xs:"stretch",sm:"center"}},children:[e.jsx(je,{value:s,exclusive:!0,onChange:l,color:"primary",sx:{flexWrap:"wrap",flexGrow:1,"& .MuiToggleButton-root":{textTransform:"none",px:2,py:1.5,borderRadius:2}},children:d.map(({type:m,name:a,description:h,Icon:f})=>e.jsx(pe,{value:m,children:e.jsxs(g,{sx:{textAlign:"left"},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(f,{fontSize:"small"}),e.jsx(j,{variant:"subtitle2",children:a})]}),e.jsx(j,{variant:"caption",color:"text.secondary",children:h})]})},m))}),e.jsx(ne,{variant:"outlined",color:"secondary",onClick:r,children:o("chat.clearConversation")})]})},_e=s=>new Intl.DateTimeFormat("default",{hour:"2-digit",minute:"2-digit"}).format(s),Ae=({message:s})=>{const t=s.sender==="user",r=s.success===!1;return e.jsx(g,{sx:{display:"flex",justifyContent:t?"flex-end":"flex-start",mb:2},children:e.jsx(g,{sx:{maxWidth:{xs:"85%",sm:"70%"}},children:r?e.jsx(K,{severity:"error",children:s.content}):e.jsxs(P,{elevation:1,sx:{p:2,bgcolor:t?"primary.main":"grey.100",color:t?"primary.contrastText":"text.primary",borderRadius:2},children:[e.jsx(j,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:s.content}),e.jsx(j,{variant:"caption",sx:{display:"block",mt:.5,opacity:.7,textAlign:"right"},children:_e(s.timestamp)})]})})})};var O={},Se=E;Object.defineProperty(O,"__esModule",{value:!0});var J=O.default=void 0,De=Se(G()),Le=e;J=O.default=(0,De.default)((0,Le.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");const Pe=({onSendMessage:s,disabled:t=!1})=>{const{t:r}=k(),[o,d]=i.useState(""),l=()=>{o.trim()&&!t&&(s(o),d(""))},m=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),l())};return e.jsx(P,{elevation:3,sx:{p:2},children:e.jsxs(g,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx(me,{fullWidth:!0,multiline:!0,maxRows:4,value:o,onChange:a=>d(a.target.value),onKeyPress:m,placeholder:r("chat.placeholder"),disabled:t,variant:"outlined",size:"small"}),e.jsx(re,{color:"primary",onClick:l,disabled:!o.trim()||t,children:e.jsx(J,{})})]})})},ke=ae`
  0% { opacity: 0.2; transform: translateY(0); }
  50% { opacity: 1; transform: translateY(-2px); }
  100% { opacity: 0.2; transform: translateY(0); }
`,ze=()=>{const{t:s}=k();return e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2,gap:1},children:[e.jsx(g,{sx:{display:"flex",gap:.5,bgcolor:"grey.100",p:2,borderRadius:2},children:[0,1,2].map(t=>e.jsx(g,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"grey.500",animation:`${ke} 1.4s infinite`,animationDelay:`${t*.2}s`}},t))}),e.jsx(j,{variant:"body2",color:"text.secondary",children:s("chat.typing")})]})},W=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).slice(2,11),We=s=>{const[t,r]=i.useState([]),[o,d]=i.useState(null),[l,m]=i.useState(s),[a,h]=i.useState(!1),[f,c]=i.useState(null),v=i.useCallback(async $=>{var R,M;if(!$.trim())return;const I=$.trim(),y={id:W(),content:I,sender:"user",timestamp:new Date};r(b=>[...b,y]),h(!0),c(null);try{const b={message:I,sessionId:o||void 0},u=await de.sendMessage(l,b);!o&&u.sessionId&&d(u.sessionId);const T={id:W(),content:u.response,sender:"agent",timestamp:new Date,success:u.success,error:u.error};r(w=>[...w,T]),u.success||c(u.error||"Unknown error occurred")}catch(b){const u=((M=(R=b.response)==null?void 0:R.data)==null?void 0:M.message)||b.message||"Network error";c(u);const T={id:W(),content:u,sender:"agent",timestamp:new Date,success:!1,error:u};r(w=>[...w,T])}finally{h(!1)}},[l,o]),C=i.useCallback(()=>{r([]),d(null),c(null)},[]),p=i.useCallback($=>{m($),C()},[C]);return{messages:t,sessionId:o,currentAgent:l,isLoading:a,error:f,sendMessage:v,clearConversation:C,changeAgent:p}},Oe=()=>{const{t:s}=k(),{messages:t,sessionId:r,currentAgent:o,isLoading:d,error:l,sendMessage:m,clearConversation:a,changeAgent:h}=We(D.INMOBILIARIA),{user:f}=ie(),c=i.useRef(null);return i.useEffect(()=>{var v;(v=c.current)==null||v.scrollIntoView({behavior:"smooth"})},[t]),e.jsxs(le,{maxWidth:"md",sx:{display:"flex",flexDirection:"column",py:2,minHeight:{xs:"calc(100vh - 56px)",sm:"calc(100vh - 64px)"}},children:[e.jsxs(P,{elevation:2,sx:{p:2,mb:2},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},flexDirection:{xs:"column",sm:"row"},gap:1,mb:1},children:[e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(j,{variant:"h5",children:s("chat.title")}),f&&e.jsxs(j,{variant:"body2",color:"text.secondary",children:[f.name," Â· ",f.email]})]}),e.jsx(g,{sx:{display:"flex",alignItems:"center",gap:1,alignSelf:{xs:"stretch",sm:"center"},width:{xs:"100%",sm:"auto"},justifyContent:{xs:"space-between",sm:"flex-end"}},children:r&&e.jsx(ge,{label:`${s("chat.sessionLabel")}: ${r.substring(0,8)}...`,size:"small"})})]}),e.jsx(we,{currentAgent:o,onChangeAgent:h,onClearConversation:a}),l&&e.jsx(K,{severity:"error",sx:{mt:2},children:l})]}),e.jsxs(P,{elevation:1,sx:{flex:1,overflowY:"auto",p:2,mb:2,bgcolor:"grey.50"},children:[t.length===0?e.jsx(g,{sx:{textAlign:"center",py:4},children:e.jsx(j,{color:"text.secondary",children:s("chat.emptyState")})}):t.map(v=>e.jsx(Ae,{message:v},v.id)),d&&e.jsx(ze,{}),e.jsx("div",{ref:c})]}),e.jsx(Pe,{onSendMessage:m,disabled:d})]})};export{Oe as ChatContainer};
